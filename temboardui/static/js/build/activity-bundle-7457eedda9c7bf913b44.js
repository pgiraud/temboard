!function(s){function t(t){for(var e,a,n=t[0],o=t[1],r=t[2],i=0,l=[];i<n.length;i++)a=n[i],c[a]&&l.push(c[a][0]),c[a]=0;for(e in o)Object.prototype.hasOwnProperty.call(o,e)&&(s[e]=o[e]);for(p&&p(t);l.length;)l.shift()();return u.push.apply(u,r||[]),d()}function d(){for(var t,e=0;e<u.length;e++){for(var a=u[e],n=!0,o=1;o<a.length;o++){var r=a[o];0!==c[r]&&(n=!1)}n&&(u.splice(e--,1),t=i(i.s=a[0]))}return t}var a={},c={1:0},u=[];function i(t){if(a[t])return a[t].exports;var e=a[t]={i:t,l:!1,exports:{}};return s[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}i.m=s,i.c=a,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/js/build";var e=window.webpackJsonp=window.webpackJsonp||[],n=e.push.bind(e);e.push=t,e=e.slice();for(var o=0;o<e.length;o++)t(e[o]);var p=n;u.push([3,0]),d()}({3:function(t,e,a){"use strict";a.r(e);var n=a(0);a.n(n)()(window,$),$(function(){var o,e=null,r=2,l=!1;$("#intervalDuration").html(r);var t=$("#tableActivity");function a(t,e){"Y"==e&&$(t).addClass("text-danger font-weight-bold")}var s="Select to terminate",d="Disable auto-refresh and select to terminate",n=[{orderable:!1,className:"text-center",data:function(t,e,a,n){var o=l?"disabled":"",r=o?d:s,i='<input type="checkbox" '+o+' class="input-xs" data-pid="'+t.pid+'"';return i+='title="'+r+'"',i+=" />"}},{title:"PID",data:"pid",className:"text-right",orderable:!1},{title:"Database",data:"database",orderable:!1},{title:"User",data:"user",orderable:!1},{title:"CPU",data:"cpu",className:"text-right"},{title:"mem",data:"memory",className:"text-right"},{title:"Read/s",data:function(t){return t.read_s.human2bytes()},render:function(t,e,a){return"display"==e?a.read_s:t},className:"text-right"},{title:"Write/s",data:function(t){return t.write_s.human2bytes()},render:function(t,e,a){return"display"==e?a.write_s:t},className:"text-right"},{title:"IOW",data:"iow",className:"text-center",createdCell:a}];n="running"==activityMode?n.concat([{title:"W",data:"wait",className:"text-center",createdCell:a}]):n.concat([{title:"Lock Rel.",data:"relation",className:"text-right",orderable:!1},{title:"Lock Mode",data:"mode",orderable:!1},{title:"Lock Type",data:"type",orderable:!1}]);n=n.concat([{title:"State",data:function(t,e,a,n){return t.state&&t.state.trunc(12)},className:"text-center",createdCell:function(t,e,a,n,o){var r="";switch(a.state){case"active":r="text-success font-weight-bold";break;case"idle in transaction":case"idle in transaction (aborted)":r="text-danger font-weight-bold"}$(t).addClass(r),12<a.state.length&&$(t).attr("title",a.state)}},{title:"Time",className:"text-right",data:"duration",render:function(t,e,a){return"display"===e?t+" s":t}},{title:"Query",className:"query",data:function(t,e,a,n){return'<pre><code class="sql">'+t.query+"</code></pre>"},createdCell:function(t,e){$(t).attr("data-toggle","popover").attr("data-trigger","hover"),$(t).mouseover(function(){var t=$("<span>",{class:"copy position-absolute right-0 pr-1 pl-1 bg-secondary text-white rounded",html:"Click to copy"});$(this).prepend(t)}),$(t).mouseout(function(){$(this).find(".copy").remove()})}}]);var i=t.DataTable({paging:!1,stateSave:!0,lengthChange:!1,autoWidth:!1,order:[[n.length-2,"desc"]],columns:n,dom:"t"});function c(){var n=new Date,t="running"!=activityMode?"/"+activityMode:"";e=$.ajax({url:"/proxy/"+agent_address+"/"+agent_port+"/activity"+t,type:"GET",beforeSend:function(t){$("#loadingIndicator").removeClass("d-none"),l=!0},async:!0,contentType:"application/json",success:function(t){$("#ErrorModal").modal("hide"),function(t){$("[data-toggle=popover]").popover("hide"),i.clear(),i.rows.add(t[activityMode].rows).draw(),$("pre code").each(function(t,e){hljs.highlightBlock(e)}),$('[data-toggle="popover"]').popover({html:!0,content:function(){return $(this).find("pre").html()},template:'<div class="popover sql" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'}),$("#waiting-count").html(t.waiting.rows.length||"&nbsp;").toggleClass("badge-warning",0<t.waiting.rows.length).toggleClass("badge-light",0<!t.waiting.rows.length),$("#blocking-count").html(t.blocking.rows.length||"&nbsp;").toggleClass("badge-warning",0<t.blocking.rows.length).toggleClass("badge-light",0<!t.blocking.rows.length)}(t)},error:function(t,e){if("abort"!=e){var a=t.status,n="Internal error.";0<a?n=f(JSON.parse(t.responseText).error):a="",$("#ErrorModal").modal("hide"),$("#modalError").html(function(t,e){var a="";return a+='<div class="modal" id="ErrorModal" tabindex="-1" role="dialog" aria-labelledby="ErrorModalLabel" aria-hidden="true">',a+='   <div class="modal-dialog">',a+='     <div class="modal-content">',a+='       <div class="modal-header">',a+='         <h4 class="modal-title" id="ErrorModalLabel">Error '+t+"</h4>",a+='         <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>',a+="       </div>",a+='       <div class="modal-body">',a+='         <div class="alert alert-danger" role="alert">'+e+"</div>",a+="       </div>",a+='       <div class="modal-footer" id="ErrorModalFooter">',a+='         <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>',a+="       </div>",a+="     </div>",a+="   </div>",a+="</div>"}(a,n)),$("#ErrorModal").modal("show")}},complete:function(t,e){$("#loadingIndicator").addClass("d-none"),l=!1;var a=1e3*r-(new Date-n);o=window.setTimeout(c,a)}})}function u(){$("#killButton").addClass("disabled"),$("#autoRefreshPausedMsg").addClass("d-none"),$("#tableActivity input:checked").each(function(){$(this).attr("checked",!1)}),$("#tableActivity input[type=checkbox]").each(function(){$(this).attr("disabled",!0),$(this).attr("title",d)}),c()}u(),$(document.body).on("click","input[type=checkbox]",function(){$("#killButton").toggleClass("disabled",0===$("#tableActivity input:checked").length)}),$("#killButton").click(function(){if(function(t){return!!xsession||(b(),t&&t.stopPropagation(),!1)}()){var t=[];if($("#tableActivity input:checked").each(function(){t.push($(this).data("pid"))}),0!==t.length){$("#Modal").modal("show"),$("#ModalLabel").html("Terminate backend");for(var e="",a=0;a<t.length;a++)e+='<span class="badge badge-primary">'+t[a]+"</span> ";$("#ModalInfo").html(e);'<button type="button" id="submitKill" class="btn btn-danger">Yes, terminate</button>',' <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>',$("#ModalFooter").html('<button type="button" id="submitKill" class="btn btn-danger">Yes, terminate</button> <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>'),$("#submitKill").click(function(){$.ajax({url:"/proxy/"+agent_address+"/"+agent_port+"/activity/kill",type:"POST",beforeSend:function(t){t.setRequestHeader("X-Session",xsession),$("#ModalInfo").html('<div class="row"><div class="col-4 offset-4"><div class="progress"><div class="progress-bar progress-bar-striped" style="width: 100%;">Please wait ...</div></div></div></div>')},async:!0,contentType:"application/json",dataType:"json",data:JSON.stringify({pids:t}),success:function(t){$("#Modal").modal("hide");var e=window.location.href;window.location.replace(e)},error:function(t){401==t.status?b():($("#ModalInfo").html('<div class="row"><div class="col-12"><div class="alert alert-danger" role="alert">Error: '+f(JSON.parse(t.responseText).error)+"</div></div></div>"),$("#ModalFooter").html('<button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>'))}})})}}});var p=$("#state-filter input[type=checkbox]");p.change(i.draw),$.fn.dataTable.ext.search.push(function(t,e,a,n){var o=[];return p.each(function(t,e){var a=$(e);a.prop("checked")&&o.push(a.val())}),-1<o.indexOf(n.state)});var h=$("#searchFilter");function b(){if(confirm("You need to be logged in the instance agent to perform this action")){var t=$.param({redirect_to:window.location.href});window.location.href=agentLoginUrl+"?"+t}}h.keyup(i.draw),$.fn.dataTable.ext.search.push(function(t,e){for(var a=h.val(),n=0,o=e.length;n<o;n++)if(-1!=e[n].toUpperCase().indexOf(a.toUpperCase()))return!0;return!1}),$("#tableActivity").on("click",".sql",function(t){t.preventDefault();var e=document.createRange(),a=window.getSelection();e.selectNodeContents(this),a.removeAllRanges(),a.addRange(e),document.execCommand("copy"),$(this).parents("td").find(".copy").html("Copied to clipboard")}),$("#tableActivity").on("mouseenter",function(t){$("#autoRefreshPausedMsg").removeClass("d-none"),e&&e.abort(),window.clearTimeout(o),$("#tableActivity input[type=checkbox]").each(function(){$(this).attr("disabled",!1),$(this).attr("title",s)})}),$("#tableActivity").on("mouseleave",function(t){0==$("#tableActivity input:checked").size()&&u()}),$("#resumeAutoRefresh").on("click",function(t){u(),t.preventDefault()})});var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function f(t){return String(t).replace(/[&<>"'\/]/g,function(t){return o[t]})}String.prototype.trunc=String.prototype.trunc||function(t){return this.length>t?this.substr(0,t-1)+"&hellip;":this},String.prototype.human2bytes=String.prototype.human2bytes||function(){var t=parseFloat(this);if("number"!=typeof t)return this;var e=this.slice(-1);return t*Math.pow(2,10*["B","K","M","G","T","P","E","Z","Y"].indexOf(e))}}});