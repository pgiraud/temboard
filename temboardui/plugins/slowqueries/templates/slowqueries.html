{% extends ../../../templates/base.html %}

{% block title %}[{{instance.hostname}}:{{instance.pg_port}}] - Slow Queries{% end %}

{% block content %}
<div class="mb-2">
  <a class="btn btn-primary" href="/server/{{instance.agent_address}}/{{instance.agent_port}}/slowqueries/settings">Settings</a>
</div>
<div id="app">
  <table class="table table-query table-sm small">
    <thead>
      <th>
        username
      </th>
      <th>
        appname
      </th>
      <th>
        dbname
      </th>
      <th>
        ntuples
      </th>
      <th>
        datetime
      </th>
      <th>
        temp_blks_written
      </th>
      <th>
        hitratio
      </th>
      <th class="text-right">
        duration
      </th>
      <th>
        query
      </th>
    </thead>
    <tbody>
      <tr v-for="query in slowQueries">
        <td>
          {{!query.username}}
        </td>
        <td>
          {{!query.appname}}
        </td>
        <td>
          {{!query.dbname}}
        </td>
        <td>
          {{!query.ntuples}}
        </td>
        <td>
          {{!moment(query.datetime).format()}}<br>
        </td>
        <td>
          {{!query.temp_blks_written}}
        </td>
        <td>
          {{!query.hitratio}}
        </td>
        <td class="text-right">
          {{!moment.duration(query.duration).format("w[w] d[d] h[h] m[m] s[s] SSS[ms]", { largest: 2 })}}
        </td>
        <td class="query" width="50%">
          <pre><code class="sql">{{! query.query }}</code></pre>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<script src="/js/moment.min.js"></script>
<script src="/js/moment-duration-format.js"></script>
<script src="/js/vue.min.js"></script>
<script src="/js/highlightjs/highlight.pack.js"></script>
<script src="/js/slowqueries/temboard.slowqueries.js"></script>
<script>
  var apiUrl = '/proxy/{{ instance.agent_address }}/{{ instance.agent_port }}/slowqueries';
</script>
{% end %}
